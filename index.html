<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Agregar Libros</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <header class="header">
    <h1>KTJ LIBRERIA</h1>
    <nav>
      <ul>
        <li><a href="#">Cerrar sesión</a></li>
      </ul>
    </nav>
  </header>

  <div class="container">
    <h1>Añadir libro</h1>
    <form id="book-form">
      <label for="title">Título:</label>
      <input type="text" id="title" name="title" required />

      <label for="author">Autor:</label>
      <input type="text" id="author" name="author" required />

      <label for="genre">Género:</label>
      <input type="text" id="genre" name="genre" required />

      <label for="publisher">Editorial:</label>
      <input type="text" id="publisher" name="publisher" required />

      <label for="date">Fecha de publicación:</label>
      <input type="date" id="date" name="date" required />

      <label for="year">Año de publicación:</label>
      <input type="number" id="year" name="year" required />

      <button type="submit">Agregar libro</button>
    </form>

    <h2>Lista de Libros</h2>
    <ul id="bookList"></ul>
  </div>

  <script>

    fetch('http://localhost:3000/api/books')
      .then(response => response.json())
      .then(data => {
        const list = document.getElementById('bookList');
        data.forEach(book => {
          const li = document.createElement('li');
          li.textContent = `${book.title} - ${book.author}`;
          list.appendChild(li);
        });
      })
      .catch(error => console.error('Error al cargar libros:', error));


    const form = document.getElementById('book-form');
    form.addEventListener('submit', function (e) {
      e.preventDefault();

      const book = {
        title: document.getElementById('title').value,
        author: document.getElementById('author').value,
        genre: document.getElementById('genre').value,  // Usando 'genre'
        publisher: document.getElementById('publisher').value, // Usando 'publisher'
        date: document.getElementById('date').value,
        year: parseInt(document.getElementById('year').value),
      };

      fetch('http://localhost:3000/api/books', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(book)
      })
        .then(response => {
          if (!response.ok) {
            throw new Error('Error al agregar el libro');
          }
          return response.json();
        })
        .then(data => {
          alert('Libro agregado correctamente');
          form.reset();
          location.reload();
        })
        .catch(error => {
          console.error('Error al enviar el libro:', error);
          alert('Ocurrió un error al enviar el libro: ' + error.message);  // Detalles del error
        });
    });
  </script>
</body>

</html>